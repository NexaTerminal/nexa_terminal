const { Document, Paragraph, TextRun, AlignmentType } = require('docx');
const moment = require('moment');

function generatePoliticsForDataProtectionDoc(formData, user, company) {
  // Get data with fallbacks
  const companyName = company?.companyName || '[Име на компанија]';
  const companyAddress = company?.companyAddress || company?.address || '[Адреса на компанија]';
  const companyNumber = company?.companyTaxNumber || company?.taxNumber || '[ЕМБС/Единствен број на компанија]';
  const companyManager = company?.companyManager || company?.manager || '[Управител]';
  
  // Form data
  const effectiveDate = formData?.effectiveDate ? moment(formData.effectiveDate).format('DD.MM.YYYY') : moment().format('DD.MM.YYYY');
  
  // Handle dataGroups - convert object to array if needed
  let selectedDataGroups = [];
  if (formData?.dataGroups) {
    if (Array.isArray(formData.dataGroups)) {
      selectedDataGroups = formData.dataGroups;
    } else if (typeof formData.dataGroups === 'object') {
      // Convert object to array
      selectedDataGroups = Object.values(formData.dataGroups);
    }
  }

  // Helper function to format selected data groups for section VII
  const formatDataGroups = () => {
    if (!selectedDataGroups || selectedDataGroups.length === 0) {
      return 'Не се избрани категории на лични податоци.';
    }
    
    return selectedDataGroups.map((group, index) => {
      return `${group.type}: ${group.description}`;
    }).join('\n\n');
  };

  // The full content from the markdown file
  const fullContent = `Согласно со одредбите на Законот за заштита на личните податоци (Службен весник на РСМ бр. 42/20, 294/21, 101/2025) и Правилникот за безбедност на обработката на личните податоци (Службен весник на РСМ бр. 266/24), ${companyName}, со регистрирано седиште на адреса: ${companyAddress}, со ЕДБ ${companyNumber} (во натамошниот текст „Друштвото" или „Контролор"), на ден ${effectiveDate} година ја усвојува следнава:

ПОЛИТИКА ЗА ЗАШТИТА НА ЛИЧНИТЕ ПОДАТОЦИ

I. ВОВЕД

Во склоп на своите деловни активности, ${companyName} има утврдено и спроведува целосно усогласен систем за заштита на личните податоци на своите вработени, назначени и ангажирани лица, како и на други субјекти на лични податоци. Како контролор на лични податоци, Друштвото ја осознава фундаменталната важност на безбедноста во процесот на обработка и ги имплементира сите обврски пропишани со Законот за заштита на личните податоци, подзаконските акти, упатствата на Агенцијата за заштита на личните податоци и другата меѓународна регулатива која ја регулира обработката на личните податоци.

Во тој контекст, оваа Политика служи како темел за имплементација на системот за заштита на личните податоци, преку кој се гарантира: стандардизиран пристап кон обработката на личните податоци, информирање на субјектите на лични податоци за начинот, целите и основите на обработката, транспарентност и отчетност во работењето, поддршка за остварување на правата на субјектите на личните податоци, како и унифицирана рамка за постапување од страна на сите лица кои ракуваат со личните податоци.

Оттука, оваа Политика претставува спроведување на стандардите за работа со лични податоци, преку која вработените, назначените и ангажирани лица, а пред сѐ субјектите на лични податоци ќе бидат информирани за начинот и целите на обработка, како и за своите права и обврски при обработката на личните податоци.

Политиката претставува имплементација на сите правила за работа со лични податоци, со цел да се олесни нивната употреба од страна на лицата кои ги обработуваат, како и од субјектите на лични податоци.

Политиката е во целосна согласност со горенаведената регулатива и со внатрешните акти на Друштвото и ги опфаќа обврските пропишани со Правилникот за безбедност на обработката на личните податоци, вклучително начелата, целите на заштита, методологијата за процена на ризик, управувањето со ризик, како и примената и ажурирањето на техничките и организациските мерки. Како таква, оваа политика се однесува на сите активности и процеси каде се врши обработка на лични податоци од страна на Друштвото, без оглед дали се автоматизирани или рачни, како и на сите системи, даватели на услуги, вработени, назначени и ангажирани лица, кои имаат пристап до лични податоци.

II. ЦЕЛ

Со оваа политика се дефинираат основните принципи, обврски, технички и организациски мерки кои Друштвото ги презема за да обезбеди усогласеност со Законот за заштита на личните податоци и Правилникот за безбедност на обработката на личните податоци.

Политиката е обврзувачка за сите вработени, назначени и ангажирани лица, обработувачи и трети страни кои врз која било основа имаат пристап до лични податоци обработувани од страна на Друштвото, а нејзината примарна цел е насочена кон обезбедување висока правна усогласеност, заштита на личните податоци и гарантирање безбедна обработка.

III. ОПФАТ И ПРИМЕНА НА ПОЛИТИКАТА ЗА ЗАШТИТА НА ЛИЧНИТЕ ПОДАТОЦИ

Оваа политика се применува на сите активности преку кои се врши обработка на лични податоци спроведувани од страна на Друштвото во текот на неговото секојдневно работење, вклучувајќи обработка на податоци на вработени, назначени и ангажирани лица, кандидати за вработување, добавувачи, посетители и други субјекти на лични податоци, без оглед дали обработката се врши автоматизирано или рачно, под услов истата да е дел од или е наменета да биде дел од збирка на лични податоци.

Системот за заштита на личните податоци на Друштвото ги опфаќа следните политики, процедури, евиденции и правила:

• Политика за заштита на личните податоци;

• Правила за технички и организациски мерки;

• Процедура за проценка на влијанието врз заштитата на личните податоци и управување со ризик;

• Политика за управување со правата на субјектите на личните податоци;

• Правила за известувања за заштита на личните податоци (приватност);

• Евиденција на активности за обработка на лични податоци;

• Политика за вработени и заштита на лични податоци;

• Правилник за видео надзор;

• Процедура за управување со ризици;

• План за континуитет на работата и План за обновување по катастрофа;

• Друга пропратна документација.

Сите наведени правила, политики и процедури претставуваат неразделен дел од воспоставениот систем за заштита на личните податоци и се применуваат како единствена, со закон усогласена целина, со цел обезбедување доследна, ефективна и законита заштита на личните податоци во рамки на сите активности на Друштвото.

IV. НАЧЕЛА НА ОБРАБОТКА НА ЛИЧНИТЕ ПОДАТОЦИ

Обработката на личните податоци од страна на Друштвото се врши во согласност со следните начела:
• Личните податоци се обработуваат согласно со закон, правично и на транспарентен начин во однос на субјектот на личните податоци („законитост, правичност и транспарентност");
• Личните податоци се собираат за конкретни, јасни и легитимни цели и не смеат да се обработуваат на начин кој не е во согласност со тие цели („ограничување на целите");
• Личните податоци се соодветни, релевантни и ограничени на она што е неопходно во однос на целите заради кои истите се обработуваат („минимален обем на податоци");
• Личните податоци се прецизни и, каде што е применливо, редовно ажурирани, при што ќе се преземат сите соодветни мерки за навремено бришење или коригирање на податоците што се неточни или нецелосни, имајќи ги предвид целите заради кои биле обработени („точност");
• Личните податоци се чувани во форма која овозможува идентификација на субјектите на личните податоци, не подолго од она што е неопходно за целите поради кои се обработуваат личните податоци („ограничување на рокот на чување");
• Личните податоци се обработуваат на начин кој обезбедува соодветно ниво на безбедност на личните податоци, вклучувајќи заштита од неовластена или незаконска обработка, како и нивно случајно губење, уништување или оштетување, со примена на соодветни технички или организациски мерки („интегритет и доверливост").

V. ДЕФИНИЦИИ

Одделни изрази употребени во оваа политика и другите документи на Друштвото за заштита на личните податоци, го имаат следното значење:
„Личен податок" е секоја информација која се однесува на идентификувано физичко лице или физичко лице кое може да се идентификува (субјект на лични податоци), а физичко лице кое може да се идентификува е лице чиј идентитет може да се утврди директно или индиректно, особено врз основа на идентификатор како на пример име и презиме, матичен број на граѓанинот, податоци за локација, идентификатор преку интернет, или врз основа на едно или повеќе обележја специфични за неговиот физички, физиолошки, генетски, ментален, економски, културен или социјален идентитет на тоа физичко лице;
„Посебни категории на лични податоци" се лични податоци кои откриваат расно или етничко потекло, политички ставови, верски или филозофски убедувања или членство во синдикални организации, како и генетски податоци, биометриски податоци, податоци што се однесуваат на здравјето или податоци за сексуалниот живот или сексуалната ориентација на физичкото лице;
„Обработка на личните податоци" е секоја операција или збир на операции кои се извршуваат врз личните податоци, или група на лични податоци, автоматски или на друг начин, како на пример: собирање, евидентирање, организирање, структурирање, чување, приспособување или промена, повлекување, консултирање, увид, употреба, откривање преку пренесување, објавување или на друг начин правење достапни, усогласување или комбинирање, ограничување, бришење или уништување;
„Збирка на лични податоци" е структурирана група лични податоци која е достапна согласно со специфични критериуми, без оглед дали е централизирана, децентрализирана или распространета на функционална или географска основа;
„Контролор" е физичко или правно лице, орган на државната власт, државен орган или правно лице основано од државата за вршење на јавни овластувања, агенција или друго тело, кое самостојно или заедно со други ги утврдува целите и начинот на обработка на личните податоци, а кога целите и начинот на обработка на личните податоци се утврдени со закон, со истиот закон се определуваат контролорот или посебните критериуми за негово определување;
„Обработувач на збирка на лични податоци" е физичко или правно лице, орган на државната власт, државен орган или правно лице основано од државата за вршење на јавни овластувања, агенција или друго тело кое ги обработува личните податоци во име на контролорот;
„Корисник" е физичко или правно лице, орган на државната власт, државен орган или правно лице основано од државата за вршење на јавни овластувања, агенција или друго тело на кое му се откриваат личните податоци, независно дали е тоа трета страна или не. Меѓутоа, органите на државната власт и државните органи на кои им се откриваат личните податоци во рамките на посебна истрага во согласност со закон, не се сметаат за корисници, при што обработката на овие податоци од овие органи мора да биде во согласност со важечките правила за заштита на личните податоци според целите на таа обработка;
„Трето лице" е секое физичко или правно лице, орган на државната власт, државен орган или правно лице основано од државата за вршење на јавни овластувања, агенција или друго тело, кое не е субјект на лични податоци, контролор, обработувач или лице, кое под директно овластување на контролорот или обработувачот е овластено да ги обработува податоците;
„Согласност" на субјектот на лични податоци е секоја слободно дадена, конкретна, информирана и недвосмислена изјавена волја на субјектот на личните податоци, преку изјава или јасно потврдено дејствие, а со кои се изразува согласност за обработка на неговите лични податоци;
„Профилирање" е секоја форма на автоматска обработка на лични податоци, која се состои од користење на лични податоци за оценување на одредени лични аспекти поврзани со физичкото лице, а особено за анализа или предвидување на аспекти кои се однесуваат на извршување на професионалните обврски на тоа физичко лице, неговата економска состојба, здравје, лични преференции, интереси, доверливост, однесување, локација или движење;
„Инцидент" е појава или промена на одредени околности кои влијаат врз правата и слободите на физичките лица во однос на обработката на личните податоци, вклучувајќи нарушување на безбедноста на личните податоци (случајно или незаконско уништување, губење, менување, неовластено откривање или пристап до лични податоци);
„Офицер за заштита на лични податоци (ОЗЛП)" е лице назначено од Контролорот, одговорно за следење на усогласеноста со регулативата за заштита на личните податоци, како и за соработка со Агенцијата за заштита на личните податоци и контакт со субјектите на лични податоци;
„Агенција за заштита на личните податоци" е самостоен и независен државен орган, надлежен да врши надзор над законитоста на преземените активности при обработката на личните податоци на територијата на Република Северна Македонија, како и заштита на темелните права и слободи на физичките лица во однос на обработката на нивните лични податоци.

VI. ПРАВНИ ОСНОВИ ЗА ОБРАБОТКА

Друштвото обработува лични податоци по пат на една или повеќе правни основи предвидени со законот, односно кога е исполнет најмалку еден од следниве услови:

• Извршување на договорна обврска - кога обработката е неопходна за исполнување на договор во кој субјектот на лични податоци е страна или за преземање дејствија пред склучување на договор по барање на субјектот.

• Усогласеност со законска обврска - кога обработката е неопходна за исполнување на обврска која ја има контролорот согласно важечки закон или подзаконски акт.

• Легитимен интерес - кога обработката е неопходна за целите на легитимен интерес на Друштвото или трето лице, освен кога над тој интерес преовладуваат интересите или основните права и слободи на субјектот, особено кога субјектот на личните податоци е дете;

• Согласност на субјектот - кога субјектот има дадено доброволна, конкретна, информирана и недвосмислена согласност за обработка на личните податоци за една или повеќе конкретни цели.

• Заштита на суштински интереси на субјектот на личните податоци - кога обработката е неопходна за заштита на животот или здравјето на субјектот или друго физичко лице.

• Извршување на работи од јавен интерес или вршење на јавни овластувања - кога обработката е неопходна за извршување на задача од јавен интерес или при вршење на јавни овластувања на контролорот утврдени со закон.

За податоците кои се обработуваат врз основа на согласност, мора да постои изрична согласност дадена од субјектот на лични податоци со која се согласува да се обработуваат неговите лични податоци за однапред определени цели.
Согласноста е дадена во писмена форма, со своерачен потпис на субјектот на лични податоци (поради докажување на постоењето на согласност) или да биде дадена на друг начин од кој недвосмислено може да се утврди дека субјектот дал согласност за обработка на неговите лични податоци.
Недавањето на согласност за обработка на лични податоци, од кои не зависи исполнувањето на обврските преземени од деловниот однос или за кои нема законска основа за обработка, не смее да биде поврзано со губење на права од деловниот однос.
При потпишување на договор за вработување или други активности каде се обработуваат лични податоци, субјектот на лични податоци задолжително се идентификува односно дадените податоци се проверуваат преку личен документ (лична карта или пасош) и Друштвото има право да задржи копија од личните документи.
Забранета е обработка на посебните категории на лични податоци.
По исклучок, обработка на посебните категории на лични податоци може да се врши ако:

- врз основа на изречна согласност на субјектот на личните податоци дадена за обработка на такви податоци, освен кога со закон е предвидено дека забраната за обработка на такви податоци не може да се отповика со изречна согласност од субјектот на лични податоци;

- е потребна заради спроведување на конкретните права и обврски на контролорот во областа на трудовото право, до степен и со соодветни гаранции утврдени со законите од оваа област;

- обработката се однесува на податоци кои субјектот на лични податоци јавно ги објавил;

- тоа е потребно заради стекнување, остварување и заштита на права на субјектот на лични податоци во постапка пред надлежни органи;

- соодветни мерки за заштита заради извршување на работи од јавен интерес се утврдени со закон или со одлука на Агенцијата;

- во други случаи утврдени во закон.

Матичниот број на граѓанинот може да се обработува само:

По претходна изречна согласност на субјектот на лични податоци;

За остварување на со закон утврдени права или обврски на субјектот на лични податоци или контролорот;

Во други случаи утврдени со закон.
Друштвото е должно да води сметка матичниот број на граѓанинот да не биде непотребно видлив, печатен или преземен од збирката на лични податоци.

VII. КАТЕГОРИИ НА ЛИЧНИ ПОДАТОЦИ И СУБЈЕКТИ

Друштвото обработува лични податоци на следниве категории на субјекти на лични податоци:

${formatDataGroups()}

Обработуваните категории на лични податоци вклучуваат основни идентификациски податоци, контакт податоци, податоци за вработување, податоци од видео надзор и други категории согласно посебните политики и процедури на Друштвото кои се неразделен дел од оваа Политика.
Друштвото користи и чува и посебни структурирани групи на лични податоци, односно збирки на лични податоци достапни согласно специфични критериуми, а кои се подетално содржани во посебна Евиденција на збирки за обработка на личните податоци.

VIII. СИСТЕМ ЗА ЗАШТИТА НА ЛИЧНИ ПОДАТОЦИ И УПРАВУВАЊЕ СО РИЗИК

Друштвото има воспоставено систем за заштита на личните податоци преку примена на технички и организациски мерки кои обезбедуваат ниво на безбедност соодветно на ризикот. Овој систем се преиспитува и ажурира редовно. Техничките и организациските мерки за заштита на личните податоци се состојат од точно определени правила на постапување, кои се прилагодени во согласност со нивото на ризик од обработката и во согласност со целите на безбедноста (заштита), и тоа:

• Минимизирање на личните податоци - Мерки кои обезбедуваат дека личните податоци се соодветни, релевантни и ограничени на она што е неопходно за целите на обработката.

• Доверливост - Целта е да се обезбеди дека ниту едно неовластено лице нема пристап или користење на личните податоци, со што се штити нивната приватност и безбедност.

• Интегритет - Гарантирање дека личните податоци што се обработуваат се целосни, точни и ажурирани. Ова вклучува усогласеност на системите и процесите со предвидените технички и организациски спецификации.

• Достапност - Обезбедување непречен и континуиран пристап до личните податоци и нивна обработка без одлагање, како и нивно правилно користење во предвидениот процес.

• Неповрзливост - Обработка на личните податоци строго ограничена на целта за која првично биле собрани, без поврзување или спојување со други лични податоци собрани за различни цели.

• Транспарентност - Обезбедување информации за обработката на личните податоци, вклучувајќи кои податоци се собираат, кога и за кои цели се обработуваат, како и кој е одговорен за нивната обработка.

• Интервенирање - Обезбедување ефективно остварување на правата на субјектите на лични податоци, вклучително и идентификација и автентикација на лицата кои ги бараат тие права.

Детален опис на применетите технички и организациски мерки и нивната примена во конкретните обработувачки процеси и активности е содржан во Правилникот за технички и организациски мерки, кој е составен дел од системот за заштита на лични податоци.

Во рамки на својата заложба за обезбедување усогласеност со прописите за заштита на личните податоци, Друштвото има воспоставено Процедура за спроведување на проценка на влијанието врз заштитата на личните податоци. Оваа Процедура утврдува јасна методологија и чекори кои се применуваат при спроведување на проценка, со цел идентификување, проценка и навремено ублажување на потенцијалните високи ризици по правата и слободите на физичките лица. Посебно внимание се посветува на случаи кога се користат нови технологии, или кога обработката поради својата природа, обем, контекст или цели претставува висок ризик. Друштвото спроведува проценка кога обработката веројатно ќе резултира со висок ризик за правата и слободите на физичките лица, особено при употреба на нови технологии, обемна обработка на посебни категории податоци, систематско мониторирање или профилирање.

Во рамки на својот систем за заштита на личните податоци, друштвото презема посебни мерки за управување со ризик. Процесот на управување со ризик опфаќа идентификација, проценка (веројатност и влијание) и ублажување на ризиците поврзани со обработката на личните податоци.

IX. ОСТВАРУВАЊЕ НА ПРАВА НА СУБЈЕКТИТЕ НА ЛИЧНИТЕ ПОДАТОЦИ

Освен обработка на личните податоци, од страна на Друштвото истовремено се преземаат и активности кои овозможуваат остварување на правата на субјектите на личните податоци.

Во таа насока, субјектите, чии лични податоци се обработувани од страна на Друштвото врз основа на една или повеќе од горенаведените правни основи ги уживаат следните права:

• Право на пристап до личните податоци;

• Право на исправка и право на бришење („да се биде заборавен");

• Право на ограничување на обработката и право на приговор на обработката;

• Право на преносливост на податоците;

• Повлекување на согласност;

• Поднесување претставка до Агенцијата за заштита на лични податоци.

Друштвото воспоставува јасна внатрешна процедура за постапување по овие барања, односно Политика за управување со правата на субјектите на личните податоци, која е составен дел од системот за заштита на лични податоци.

X. ОБРАБОТКА НА ЛИЧНИ ПОДАТОЦИ ОД СТРАНА НА ОБРАБОТУВАЧИ ВО ИМЕ НА КОНТРОЛОРОТ

Обработката од страна на обработувачот се регулира со договор или со друг правен акт во согласност со закон, кој е обврзувачки за обработувачот во однос на контролорот и со кој се регулира предметот и времетраењето на обработката, природата и целта на обработката, видот на личните податоци и категориите на субјекти на личните податоци, како и обврските и правата на контролорот.

Договорот или другиот правен акт треба да биде во писмена форма, односно во електронска форма, согласно со закон.

XI. ВИДЕО НАДЗОР

Друштвото има воспоставено политика за вршење на видео надзор со која ги утврдува принципите за законита, правична и транспарентна обработка на личните податоци преку системи за видео надзор, во согласност со Законот за заштита на личните податоци и соодветниот Правилник. Целта е да се обезбеди заштита на имотот, безбедност на лицата и јавниот интерес, при целосно почитување на приватноста и правата на сите кои влегуваат во надгледуваните простори. Начините на воспоставување на системот, обезбедување на безбедност и заштита на личните податоци се детално опфатени со Политиката за видео надзор на Друштвото.

XII. ПРОЦЕДУРА ЗА УПРАВУВАЊЕ СО ИНЦИДЕНТИ НА НАРУШУВАЊЕ НА БЕЗБЕДНОСТА НА ЛИЧНИТЕ ПОДАТОЦИ

Во своето работење, Друштвото спроведува Процедура за управување со инциденти на нарушување на безбедноста на личните податоци. Оваа Процедура ги утврдува чекорите и одговорностите на Друштвото за навремена детекција, проценка, соодветен одговор, известување до надлежниот орган и засегнатите субјекти, како и санирање на секое идентификувано нарушување на безбедноста на личните податоци.

Процедурата претставува задолжителна алатка во секојдневното постапување на вработените и одделите, особено во ситуации каде е загрозена доверливоста, интегритетот или достапноста на личните податоци, и обезбедува систематизирано и ефикасно справување со инциденти.

Детални процедури за детекција, евалуација, одговор и известување за инциденти се содржани во Процедурата за управување со инциденти на нарушување на безбедноста на личните податоци и интегрирани во Правилата за техничките и организациските мерки.

XIII. ПЛАН ЗА КОНТИНУИТЕТ НА РАБОТАТА И ПЛАН ЗА ОБНОВУВАЊЕ ПО КАТАСТРОФА

Со цел да се обезбеди непречено функционирање на критичните деловни процеси и заштита на информациските ресурси, вклучително и личните податоци, Друштвото има изработено и План за континуитет на работата и План за обновување по катастрофа. Овие планови утврдуваат стратегии и процедури за превенција, подготвеност, одговор и обновување при настани што предизвикуваат прекин на работењето или нарушување на безбедноста на личните податоци. Нивната примена овозможува навремена реакција и минимизирање на последиците врз работата на Друштвото, клиентите и засегнатите субјекти на податоци.

Плановите се составен дел од системот за управување со ризици и се задолжителни за сите релевантни организациски единици, со јасно дефинирани улоги и одговорности при активирање на мерките за континуитет и обновување.

XIV. ПРЕНЕСУВАЊЕ НА ЛИЧНИТЕ ПОДАТОЦИ

Секое пренесување на лични податоци во земји-членки на ЕУ, земји потписнички на Конвенцијата 108+, и земји-членки на НАТО се врши согласно дозволените механизми предвидени со Законот.

XV. УЛОГИ И ОДГОВОРНОСТИ

Органот на управување / Менаџментот на друштвото како контролор: Го одобрува системот за заштита на лични податоци, вклучувајќи ја оваа Политика и сите поврзани акти, и обезбедува потребни ресурси за нивна имплементација и одржување.

Контролорот именува Офицер за заштита на личните податоци, кој е одговорен за надзор над примената на прописите за заштита на личните податоци, давање стручни совети и следење на усогласеноста со законските и подзаконските акти. Сите организациски единици се обврзани да соработуваат со Офицерот за заштита на личните податоци и да постапуваат согласно неговите укажувања и препораки во рамките на неговите надлежности.

Офицер за заштита на лични податоци:
(а) ги информира и советува контролорот или обработувачот и вработените кои вршат обработка соодветно на нивните обврски според одредбите од Законот за заштита на личните податоци;
(б) ја следи усогласеноста со Законот за заштита на личните податоци, со други засегнати закони кои се однесуваат на заштитата на личните податоци во Република Северна Македонија, како и со политиките на контролорот или обработувачот во однос на заштитата на личните податоци, вклучувајќи распределување на одговорности, подигнување на свеста и обучување на вработените кои учествуваат во операциите на обработка, како и вршење на ревизии за заштита на личните податоци;
(в) каде што е потребно, дава совети во однос на процената на влијанието на заштитата на личните податоци;
(г) соработува со Агенцијата;
(д) дејствува како контакт точка за Агенцијата во однос на прашањата поврзани со обработката, вклучувајќи ја претходната консултација, како и советување според потребите за сите други прашања.

При извршувањето на своите работи, офицерот за заштита на личните податоци ги зема предвид ризиците поврзани со операциите на обработката, како и природата, обемот, контекстот и целите на обработката.

Менаџери и раководители на оддели: Одговорни се за обезбедување дека нивните оддели ги разбираат и применуваат принципите и процедурите од оваа Политика и поврзаните акти.

Вработени: Секој вработен кој обработува лични податоци е одговорен за почитување на оваа Политика и сите поврзани процедури. Сите вработени се обучуваат за нивните обврски и се обврзани со доверливост.

XVI. УСОГЛАСЕНОСТ И АЖУРИРАЊЕ НА ПОЛИТИКАТА

Оваа Политика се преиспитува барем еднаш годишно или по значајна промена на регулативата, организациската структура или резултати од внатрешни/надворешни контроли.

${effectiveDate}.

${companyName}
${companyManager}`;

  // Split the full content into paragraphs and process them
  const paragraphs = fullContent.split('\n\n').filter(p => p.trim());
  const docParagraphs = [];

  paragraphs.forEach((paragraph, index) => {
    const trimmedParagraph = paragraph.trim();
    
    if (trimmedParagraph === 'ПОЛИТИКА ЗА ЗАШТИТА НА ЛИЧНИТЕ ПОДАТОЦИ') {
      // Main title - centered and bold
      docParagraphs.push(
        new Paragraph({
          children: [
            new TextRun({
              text: trimmedParagraph,
              bold: true,
              size: 28
            })
          ],
          alignment: AlignmentType.CENTER,
          spacing: { after: 800 }
        })
      );
    } else if (trimmedParagraph.match(/^[IVX]+\.\s/)) {
      // Roman numeral sections (I., II., III., etc.) - bold and with extra spacing
      docParagraphs.push(
        new Paragraph({
          children: [
            new TextRun({
              text: trimmedParagraph,
              bold: true,
              size: 24
            })
          ],
          alignment: AlignmentType.JUSTIFIED,
          spacing: { before: 600, after: 400 }
        })
      );
    } else {
      // Check if paragraph starts with capital letters followed by regular text
      const mixedContentMatch = trimmedParagraph.match(/^([АБВГДЕФХИЈКЛМНОПРСТУВЗШЧЌЃЈЉЊЏЅЦ\s\.\:]+?)\s+([а-зшчќѓјљњџѕц].*)$/);
      
      if (mixedContentMatch) {
        // Split into bold title and regular content
        const boldTitle = mixedContentMatch[1].trim();
        const regularContent = mixedContentMatch[2].trim();
        
        // Add bold title paragraph
        docParagraphs.push(
          new Paragraph({
            children: [
              new TextRun({
                text: boldTitle,
                bold: true
              })
            ],
            alignment: AlignmentType.JUSTIFIED,
            spacing: { after: 200, line: 276 }
          })
        );
        
        // Add regular content paragraph
        docParagraphs.push(
          new Paragraph({
            children: [
              new TextRun({
                text: regularContent
              })
            ],
            alignment: AlignmentType.JUSTIFIED,
            spacing: { after: 400, line: 276 }
          })
        );
      } else if (trimmedParagraph.startsWith('•')) {
        // Bullet points - justified alignment
        docParagraphs.push(
          new Paragraph({
            children: [
              new TextRun({
                text: trimmedParagraph
              })
            ],
            alignment: AlignmentType.JUSTIFIED,
            spacing: { after: 200, line: 276 }
          })
        );
      } else if (trimmedParagraph.startsWith('„') && trimmedParagraph.endsWith(';')) {
        // Definition items - justified alignment
        docParagraphs.push(
          new Paragraph({
            children: [
              new TextRun({
                text: trimmedParagraph
              })
            ],
            alignment: AlignmentType.JUSTIFIED,
            spacing: { after: 200, line: 276 }
          })
        );
      } else {
        // Regular paragraphs - justified alignment
        docParagraphs.push(
          new Paragraph({
            children: [
              new TextRun({
                text: trimmedParagraph
              })
            ],
            alignment: AlignmentType.JUSTIFIED,
            spacing: { after: 300, line: 276 }
          })
        );
      }
    }
  });

  // Add signature section at the end
  docParagraphs.push(
    new Paragraph({
      children: [
        new TextRun({
          text: "___________________________",
        })
      ],
      alignment: AlignmentType.CENTER,
      spacing: { before: 600, after: 200 }
    }),
    new Paragraph({
      children: [
        new TextRun({
          text: companyManager,
          bold: true
        })
      ],
      alignment: AlignmentType.CENTER,
      spacing: { after: 100 }
    }),
    new Paragraph({
      children: [
        new TextRun({
          text: "Управител"
        })
      ],
      alignment: AlignmentType.CENTER,
      spacing: { after: 300, line: 276 }
    })
  );

  const doc = new Document({
    sections: [{
      children: docParagraphs
    }]
  });

  return {
    doc,
    filenameSuffix: `Politika_zastita_LP_${companyName.replace(/\s+/g, '_')}_${moment().format('YYYY_MM_DD')}`
  };
}

module.exports = generatePoliticsForDataProtectionDoc;